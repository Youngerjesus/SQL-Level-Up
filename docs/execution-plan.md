## DBMS 와 실행 계획

***

RDB 에서 어플리케이션 개발자는 SQL 문을 작성하면 알아서 데이터베이스에서 그거에 맞는 데이터를 가지고온다.

어플리케이션 개발자는 어떻게 데이터를 가지고 오는지 몰라도 된다. 선언적으로 어떤 데이터를 가지고 올지만 SQL 문으로
작성해두면 시스템이 알아서 가지고 온다. 자바나 파이썬 C 같은 언어처럼 '어떻게' 가지고 올지 명령하지 않아도 된다.
 
이런 SQL 문이 좋다 나쁘다 평가할 건 아니지만 이렇게 SQL 문을 선언적으로 만든 이유는 생산성 때문이다. 

DBMS 는 모든 어플리케이션에서 사용하는데 내부 동작까지 알려고 한다면 생산성이 떨어지기 떄문이다.

하지만 SQL 문 자체가 완벽한 언어는 아니기 떄문에 개발자라면 어떻게 동작하는지 알고 있어야 한다 라고 생각한다.

#### 데이터에 접근하는 방법은 어떻게 결정할까? 

이전에 살펴본 쿼리 평가 엔진은 사용자로 부터 전달받은 SQL 문을 분석에서 그거에 맞는 최적의 실행 계획을 찾는다고 했다.

그 쿼리 평가 엔진의 처리는 다음과 같이 이뤄진다.  

__1. 파서(Parser)의 SQL 문 처리__

 - 파서의 역할은 SQL 문을 분석하고 문법적으로 오류가 없는지 검사하는 역할을 한다. 서류 심사 같은 역할을 해주고 SQL 구문을
 처리하기 쉬운 형식으로 변환해주는 역할을 한다.
 
__2. 옵티마이저(Optimizer)__

- 서류 심사를 통과한 SQL 문은 옵티마이저에게 전달되고 옵티마이저는 데이터를 기반으로 최적의 실행 계획을 평가한다. 
이런 데이터는 이후에 나올 카탈로그 매니저(Catalog Manager)가 전달해주는 역할을 하고 데이터에는 인덱스의 유무, 테이블에 있는 데이터의 수, 칼럼의 개수 등이 있다.
실행 계획은 여러개가 나올 수 있는데 이 중에서 가장 비용이 낮은게 선택된다. 

__3. 플랜 평가(Plan Evaluation)__

- 옵티마이저가 세운 실행 계획을 받아서 최적의 실행 계획을 선택하는 역할을 한다. 

#### 옵티마이저와 통계 정보

옵티마이저가 세우는 실행 계획은 카탈로그 매니저가 주는 데이터를 기반으로 만든다. 

카탈로그 매니저가 주는 데이터는 다음과 같다.

- 테이블 레코드 수

- 인덱스 정보

- 필드의 카디널리티(Cardinality)

- 필드 값의 분포도 

- 필드 내부에 있는 NULL 수 

옵티마이저가 최적의 실행 계획을 주지 않을 수 있는 이유는 카탈로그 매니저가 주는 데이터가 최신 데이터가 아니기 떄문이다. 

즉 옵티마이저가 제대로 작동하기 위해서는 카탈로그 매니저가 최신의 정보를 줘야한다. 그렇다고 해서 매 요청마다 최신으로 통계 정보를 동기화 하라고 하는건 
비용이 비싸다. 그러므로 동기화 하는 시점을 결정해주는 것이 중요하다. 

MySQL 에서는 `ANALYZE TABLE [스키아 이름][테이블 이름]` 으로 통계 정보 동기화가 가능하다. 






